<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Registers - OC-Accel Doc</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">OC-Accel Doc</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../..">Overview</a>
</li>
                                    
<li >
    <a href="../../repository/">About the repository</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../user-guide/0-steps/">(0) Steps in a glance</a>
</li>
                                    
<li >
    <a href="../../user-guide/1-prepare-env/">(1) Prepare environment</a>
</li>
                                    
<li >
    <a href="../../user-guide/2-run-helloworld/">(2) Run helloworld</a>
</li>
                                    
<li >
    <a href="../../user-guide/3-new-action/">(3) Create a new action</a>
</li>
                                    
<li >
    <a href="../../user-guide/4-hdl-design/">(4) Verilog/VHDL design</a>
</li>
                                    
<li >
    <a href="../../user-guide/5-hls-design/">(5) HLS C++ design</a>
</li>
                                    
<li >
    <a href="../../user-guide/6-co-simulation/">(6) Co-Simulation</a>
</li>
                                    
<li >
    <a href="../../user-guide/7-build-image/">(7) Build image</a>
</li>
                                    
<li >
    <a href="../../user-guide/8-deploy/">(8) Deploy on Power Server</a>
</li>
                                    
<li >
    <a href="../../user-guide/9-migrate/">(9) Migrate from SNAP1/2</a>
</li>
                                    
<li >
    <a href="../../user-guide/10-tips/">(10) Tips</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../actions-doc/hdl_example/">hdl_example</a>
</li>
                                    
<li >
    <a href="../../actions-doc/hdl_single_engine/">hdl_single_engine</a>
</li>
                                    
<li >
    <a href="../../actions-doc/hls_helloworld/">hls_helloworld</a>
</li>
                                    
<li >
    <a href="../../actions-doc/hls_memcopy_1024/">hls_memcopy_1024</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Deep Dive <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../software-api/">Software API</a>
</li>
                                    
<li class="active">
    <a href="./">Registers</a>
</li>
                                    
<li >
    <a href="../hardware-logic/">Hardware Logic</a>
</li>
                                    
<li >
    <a href="../board-package/">New Board Support</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../misc/doc-guide/">Document Guide</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../software-api/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../hardware-logic/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.ibm.com/OC-Enablement/oc-snap"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#snap-registers">SNAP Registers</a></li>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#address-map">Address Map</a></li>
        <li class="main "><a href="#register-definition">Register Definition</a></li>
            <li><a href="#snap-basic-registers">SNAP Basic Registers</a></li>
            <li><a href="#snap-debug-registers-0x0">SNAP Debug Registers 0x0</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="snap-registers">SNAP Registers</h1>
<h2 id="overview">Overview</h2>
<p>SNAP registers are defined in the MMIO General space for each AFU. Action specific registers (registers related to AFU's function) are defined in the per PASID MMIO space. All of those address mapping parameters (BAR, MMIO general, MMIO PASID, and also memory space) are specified with respect to OpenCAPI configuration space specification. SNAP core hardware is responsible for handling the configuration read/write from host and maintaining the configuration space and SNAP registers.</p>
<p><img alt="drawing" src="registers.assets/SNAP-registers.svg" /></p>
<h2 id="address-map">Address Map</h2>
<p>Only lower 32bits are used for MMIO addresses. There are two regions: SNAP registers and Action registers. 
* SNAP registers are 64b registers, use <code>snap_mmio_read64/write64()</code> to access them, and the address should be aligned to 8. SNAP registers are in global MMIO space. It has three categories:
  * SNAP Basic Registers: addr[20:8] = 0x0000;
  * SNAP Debug Registers: addr[20:8] = 0x0001;
  * SNAP FIR Registers:   addr[20:8] = 0x0002;</p>
<ul>
<li>Action registers are 32b registers, use <code>snap_action_read32/write32()</code> to access them, and the address should be aligned to 4. Action registers are in per PASID MMIO space. They are completely user defined. User can freely use 2MB space, that means, using addr[20:0].</li>
</ul>
<h1 id="register-definition">Register Definition</h1>
<h2 id="snap-basic-registers">SNAP Basic Registers</h2>
<h3 id="impl-version-register-ivr">Impl. Version Register (IVR)</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Offset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Implementation Version Register</td>
<td>0x00</td>
<td>POR value depends on source for the build. Example for build based on commit with SHA ID eb43f4d80334d6a127af150345fed12dc5f45b7c and with distance 13 to SNAP Release v1.25.4: 0x0119040D_EB43F4D8</td>
</tr>
</tbody>
</table>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th></th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..40</td>
<td></td>
<td>RO</td>
<td>SNAP Release</td>
</tr>
<tr>
<td></td>
<td>63..56</td>
<td>RO</td>
<td>Major release number</td>
</tr>
<tr>
<td></td>
<td>55..48</td>
<td>RO</td>
<td>Intermediate release number</td>
</tr>
<tr>
<td></td>
<td>47..40</td>
<td>RO</td>
<td>Minor release number</td>
</tr>
<tr>
<td>39..32</td>
<td></td>
<td>RO</td>
<td>Distance of commit to SNAP release</td>
</tr>
<tr>
<td>31..0</td>
<td></td>
<td>RO</td>
<td>First eight digits of SHA ID for commit</td>
</tr>
</tbody>
</table>
<h3 id="build-date-register-bdr">Build Date Register (BDR)</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Offset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Build Date Register</td>
<td>0x08</td>
<td>POR value depends on build date and time. Example for build on January 12th, 2017 at 15:27: 0x00002017_01121527</td>
</tr>
</tbody>
</table>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..48</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>47.. 0</td>
<td>RO</td>
<td>BCD coded build date and time</td>
</tr>
<tr>
<td>47..32</td>
<td>RO</td>
<td>YYYY (year)</td>
</tr>
<tr>
<td>31..24</td>
<td>RO</td>
<td>mm   (month)</td>
</tr>
<tr>
<td>23..16</td>
<td>RO</td>
<td>dd   (day of month)</td>
</tr>
<tr>
<td>15..08</td>
<td>RO</td>
<td>HH   (hour)</td>
</tr>
<tr>
<td>07..00</td>
<td>RO</td>
<td>MM   (minute)</td>
</tr>
</tbody>
</table>
<h3 id="snap-command-register-scr">SNAP Command Register (SCR)</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Offset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SNAP Command Register</td>
<td>0x10</td>
<td>Send SNAP commands via this register</td>
</tr>
</tbody>
</table>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..48</td>
<td>RW</td>
<td>Argument</td>
</tr>
<tr>
<td>47..8</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>7..0</td>
<td>RW</td>
<td>Command. Legal commands are:</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0x10 Exploration Done: Set Exploration Done bit in SNAP status register. Argument bits 63..52: Don't care. Argument bits 51..48: Maximum Short Action Type</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0x08 Reset: Reset the complete SNAP framework including all actions immediately. Argument: Don't care</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0x04 Abort: Abort current jobs and set accelerator to finished immediately (asserting aXh_jdone). Argument: Don't care</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0x02 Stop: Finish current jobs, then set accelerator to finished (asserting aXh_jdone). Argument: Don't care</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0x00 NOP</td>
</tr>
</tbody>
</table>
<h3 id="snap-status-register-ssr">SNAP Status Register (SSR)</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Offset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SNAP Status Register</td>
<td>0x18</td>
<td>POR value: 0x0000000000000000</td>
</tr>
</tbody>
</table>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..9</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>8</td>
<td>RO</td>
<td>Exploration Done. This means that the ATRi setup is complete and the values are valid</td>
</tr>
<tr>
<td>7..4</td>
<td>RO</td>
<td>Maximum Short Action Type (number of Short Action Types - 1)</td>
</tr>
<tr>
<td>3..0</td>
<td>RO</td>
<td>Maximum Action ID</td>
</tr>
</tbody>
</table>
<h3 id="snap-capability-register-cap">SNAP Capability Register (CAP)</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Offset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SNAP Capability Register</td>
<td>0x20</td>
<td>Define the capability of the card</td>
</tr>
</tbody>
</table>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..40</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>39..36</td>
<td>RO</td>
<td>Minimum size for DMA transfers to/from Host. Value t means that minimum transfer size is 2^t B</td>
</tr>
<tr>
<td>35..32</td>
<td>RO</td>
<td>Data alignment for DMA transfers to/from Host. Value a means that transfers need to be 2^a B aligned</td>
</tr>
<tr>
<td>31..16</td>
<td>RO</td>
<td>Size of attached on-card SDRAM in MB</td>
</tr>
<tr>
<td>15..9</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>8</td>
<td>RO</td>
<td>NVMe enabled</td>
</tr>
<tr>
<td>7..0</td>
<td>RO</td>
<td>Card type:</td>
</tr>
<tr>
<td></td>
<td>0x31 : AD9V3</td>
<td></td>
</tr>
<tr>
<td></td>
<td>0x32 : AD9H7</td>
<td></td>
</tr>
<tr>
<td></td>
<td>0x33 : N250SoC</td>
<td></td>
</tr>
<tr>
<td></td>
<td>0x34 : Innova2</td>
<td></td>
</tr>
<tr>
<td></td>
<td>0x35 : AD9H3</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="action-type-register-atr">Action Type Register (ATR)</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Offset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Action Type Register</td>
<td>0x28</td>
<td>POR value: 0x00000000_00000000. LIBSNAP needs to specify the values based on the result of an exploration phase</td>
</tr>
</tbody>
</table>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..36</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>35..32</td>
<td>RW</td>
<td>Internal Short Action Type</td>
</tr>
<tr>
<td>31.. 0</td>
<td>RW</td>
<td>Action type for action i (all zero if no Action i is implemented)</td>
</tr>
</tbody>
</table>
<h3 id="freerunning-timer-frt">Freerunning Timer (FRT)</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Offset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Freerunning Timer</td>
<td>0x0080</td>
<td>Counting the number of clock cycles since reset</td>
</tr>
</tbody>
</table>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..0</td>
<td>RO</td>
<td>Counter counting the number of clock cycles since reset (afu open). This counter increments with the 250MHz PSL clock</td>
</tr>
</tbody>
</table>
<h2 id="snap-debug-registers-0x0">SNAP Debug Registers 0x0</h2>
<h3 id="debug-clear-register-dbg_clr">Debug Clear Register (DBG_CLR)</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Offset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Debug Clear Register</td>
<td>0x0080</td>
<td>Counting the number of clock cycles since reset</td>
</tr>
</tbody>
</table>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..0</td>
<td>RO</td>
<td>Counter counting the number of clock cycles since reset (afu open). This counter increments with the 250MHz PSL clock</td>
</tr>
</tbody>
</table></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../extra.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
